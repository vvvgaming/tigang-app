<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0a1a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="TIGANG - Web3å¥åº·è®­ç»ƒåº”ç”¨ï¼Œæ¯æ—¥æè‚›æ‰“å¡èµšå–ä»£å¸å¥–åŠ±">
<link rel="manifest" href="manifest.json">
<title>TIGANG | æè‚›è®­ç»ƒåŠ©æ‰‹</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ===== CSS Variables ===== */
:root {
  --bg-primary: #0a0a1a;
  --bg-secondary: #111128;
  --bg-card: #181838;
  --bg-card-hover: #1e1e45;
  --accent-primary: #00f5d4;
  --accent-secondary: #7b61ff;
  --accent-warm: #f77f00;
  --accent-pink: #ff6b9d;
  --accent-gold: #ffd166;
  --text-primary: #e8e8f0;
  --text-secondary: #8888aa;
  --text-muted: #555570;
  --border: rgba(123, 97, 255, 0.15);
  --glow-primary: rgba(0, 245, 212, 0.3);
  --glow-secondary: rgba(123, 97, 255, 0.3);
  --radius: 16px;
  --radius-sm: 10px;
  --radius-xs: 6px;
  --shadow: 0 8px 32px rgba(0,0,0,0.4);
}

/* ===== Reset & Base ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 16px; -webkit-tap-highlight-color: transparent; }
body {
  font-family: 'Noto Sans SC', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* ===== Background Atmosphere ===== */
body::before {
  content: '';
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: 
    radial-gradient(ellipse at 20% 50%, rgba(123,97,255,0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 20%, rgba(0,245,212,0.04) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 80%, rgba(247,127,0,0.03) 0%, transparent 50%);
  z-index: 0;
  pointer-events: none;
  animation: bgShift 20s ease-in-out infinite alternate;
}
@keyframes bgShift {
  0% { transform: translate(0, 0) rotate(0deg); }
  100% { transform: translate(-3%, -2%) rotate(3deg); }
}

/* ===== App Container ===== */
.app {
  position: relative;
  z-index: 1;
  max-width: 480px;
  margin: 0 auto;
  min-height: 100vh;
  min-height: 100dvh;
  padding-bottom: 90px;
}

/* ===== Page Transitions ===== */
.page {
  display: none;
  animation: pageIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  padding: 0 20px;
}
.page.active { display: block; }
@keyframes pageIn {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== Header ===== */
.header {
  padding: 16px 20px 8px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}
.logo-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  box-shadow: 0 4px 16px var(--glow-primary);
}
.logo-text {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  font-size: 16px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 1px;
}
.header-wallet {
  display: flex;
  align-items: center;
  gap: 6px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 6px 14px;
  font-size: 12px;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.3s;
}
.header-wallet:hover { border-color: var(--accent-primary); color: var(--accent-primary); }
.wallet-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--accent-warm);
}
.wallet-dot.connected { background: var(--accent-primary); }

/* ===== Home Page ===== */
.greeting {
  padding: 20px 0 6px;
  font-size: 22px;
  font-weight: 700;
}
.greeting-sub {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}

/* Streak Card */
.streak-card {
  background: linear-gradient(135deg, #1a1a40 0%, #0d1f3c 50%, #1a1040 100%);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}
.streak-card::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -30%;
  width: 200px;
  height: 200px;
  background: radial-gradient(circle, var(--glow-primary) 0%, transparent 70%);
  opacity: 0.15;
}
.streak-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 16px;
  position: relative;
  z-index: 1;
}
.streak-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 2px;
  font-family: 'Space Mono', monospace;
}
.streak-number {
  font-family: 'Orbitron', sans-serif;
  font-size: 56px;
  font-weight: 900;
  line-height: 1;
  background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
  z-index: 1;
}
.streak-unit {
  font-size: 16px;
  color: var(--text-secondary);
  margin-left: 4px;
  font-family: 'Noto Sans SC', sans-serif;
  -webkit-text-fill-color: var(--text-secondary);
}
.streak-badge {
  background: rgba(0, 245, 212, 0.1);
  border: 1px solid rgba(0, 245, 212, 0.2);
  border-radius: 20px;
  padding: 4px 12px;
  font-size: 11px;
  color: var(--accent-primary);
  font-family: 'Space Mono', monospace;
}
.week-dots {
  display: flex;
  gap: 8px;
  position: relative;
  z-index: 1;
}
.week-dot {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}
.week-dot-label {
  font-size: 10px;
  color: var(--text-muted);
  font-family: 'Space Mono', monospace;
}
.week-dot-circle {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid var(--text-muted);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  transition: all 0.3s;
}
.week-dot-circle.done {
  border-color: var(--accent-primary);
  background: rgba(0, 245, 212, 0.15);
  box-shadow: 0 0 12px var(--glow-primary);
}
.week-dot-circle.today {
  border-color: var(--accent-secondary);
  background: rgba(123, 97, 255, 0.15);
  animation: todayPulse 2s ease-in-out infinite;
}
@keyframes todayPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(123, 97, 255, 0.4); }
  50% { box-shadow: 0 0 0 8px rgba(123, 97, 255, 0); }
}

/* Start Training Button */
.start-btn {
  width: 100%;
  padding: 18px;
  border: none;
  border-radius: var(--radius);
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: var(--bg-primary);
  font-size: 18px;
  font-weight: 700;
  font-family: 'Noto Sans SC', sans-serif;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.3s;
  margin-bottom: 20px;
}
.start-btn:active { transform: scale(0.97); }
.start-btn:hover {
  box-shadow: 0 8px 32px var(--glow-primary), 0 4px 16px var(--glow-secondary);
}
.start-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transform: translateX(-100%);
  animation: shimmer 3s ease-in-out infinite;
}
@keyframes shimmer {
  0% { transform: translateX(-100%); }
  50% { transform: translateX(100%); }
  100% { transform: translateX(100%); }
}

/* Quick Stats */
.quick-stats {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 12px;
  margin-bottom: 24px;
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 16px 12px;
  text-align: center;
}
.stat-icon { font-size: 20px; margin-bottom: 8px; }
.stat-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-primary);
}
.stat-label {
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* Token Reward Banner */
.token-banner {
  background: linear-gradient(135deg, rgba(255, 209, 102, 0.1), rgba(247, 127, 0, 0.08));
  border: 1px solid rgba(255, 209, 102, 0.2);
  border-radius: var(--radius);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 24px;
  cursor: pointer;
  transition: all 0.3s;
}
.token-banner:hover { border-color: var(--accent-gold); }
.token-icon {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-gold), var(--accent-warm));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(255, 209, 102, 0.3);
}
.token-info { flex: 1; }
.token-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--accent-gold);
}
.token-desc {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 2px;
}
.token-amount {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--accent-gold);
}

/* ===== Training Page ===== */
.training-header {
  text-align: center;
  padding: 20px 0 10px;
}
.training-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
}
.training-subtitle {
  font-size: 13px;
  color: var(--text-secondary);
}

/* Training Circle */
.training-circle-wrap {
  display: flex;
  justify-content: center;
  padding: 30px 0;
}
.training-circle {
  width: 260px;
  height: 260px;
  border-radius: 50%;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}
.training-circle svg {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  transform: rotate(-90deg);
}
.training-circle .track {
  fill: none;
  stroke: var(--bg-card);
  stroke-width: 6;
}
.training-circle .progress-ring {
  fill: none;
  stroke: url(#progressGrad);
  stroke-width: 6;
  stroke-linecap: round;
  stroke-dasharray: 754;
  stroke-dashoffset: 754;
  transition: stroke-dashoffset 0.5s ease;
}
.training-phase {
  font-size: 14px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 3px;
  font-family: 'Space Mono', monospace;
  margin-bottom: 4px;
  z-index: 1;
}
.training-action {
  font-size: 36px;
  font-weight: 900;
  z-index: 1;
  transition: all 0.3s;
}
.training-action.contract { color: var(--accent-primary); }
.training-action.relax { color: var(--accent-secondary); }
.training-action.rest { color: var(--text-muted); }
.training-timer {
  font-family: 'Orbitron', sans-serif;
  font-size: 48px;
  font-weight: 900;
  z-index: 1;
}
.training-round {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 8px;
  z-index: 1;
}

/* Breathing Animation */
.breath-ring {
  position: absolute;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  border: 2px solid rgba(0, 245, 212, 0.1);
  transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}
.breath-ring.contract {
  width: 160px;
  height: 160px;
  border-color: rgba(0, 245, 212, 0.3);
  box-shadow: 0 0 40px var(--glow-primary), inset 0 0 40px rgba(0, 245, 212, 0.05);
}
.breath-ring.relax {
  width: 220px;
  height: 220px;
  border-color: rgba(123, 97, 255, 0.3);
  box-shadow: 0 0 40px var(--glow-secondary), inset 0 0 40px rgba(123, 97, 255, 0.05);
}

/* Training Controls */
.training-controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  padding: 10px 0 20px;
}
.train-ctrl-btn {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 2px solid var(--border);
  background: var(--bg-card);
  color: var(--text-primary);
  font-size: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
}
.train-ctrl-btn:hover { border-color: var(--accent-primary); }
.train-ctrl-btn.primary {
  width: 72px;
  height: 72px;
  border-color: var(--accent-primary);
  background: rgba(0, 245, 212, 0.1);
  font-size: 28px;
}

/* Training Modes */
.mode-selector {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  overflow-x: auto;
  padding: 4px 0;
  -webkit-overflow-scrolling: touch;
}
.mode-card {
  flex-shrink: 0;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 14px 18px;
  cursor: pointer;
  transition: all 0.3s;
  min-width: 130px;
}
.mode-card.active {
  border-color: var(--accent-primary);
  background: rgba(0, 245, 212, 0.05);
}
.mode-card-icon { font-size: 24px; margin-bottom: 6px; }
.mode-card-name { font-size: 13px; font-weight: 700; }
.mode-card-desc { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }

/* ===== Stats Page ===== */
.section-title {
  font-size: 18px;
  font-weight: 700;
  margin: 24px 0 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.chart-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
}
.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}
.chart-title { font-size: 14px; font-weight: 700; }
.chart-period {
  font-size: 11px;
  color: var(--text-secondary);
  background: var(--bg-secondary);
  padding: 4px 10px;
  border-radius: 12px;
  cursor: pointer;
}
.bar-chart {
  display: flex;
  align-items: flex-end;
  gap: 6px;
  height: 120px;
  padding-top: 10px;
}
.bar-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  height: 100%;
  justify-content: flex-end;
}
.bar {
  width: 100%;
  max-width: 28px;
  border-radius: 4px 4px 0 0;
  background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
  opacity: 0.7;
  transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  min-height: 4px;
}
.bar.today-bar { opacity: 1; box-shadow: 0 0 12px var(--glow-primary); }
.bar-label {
  font-size: 10px;
  color: var(--text-muted);
  font-family: 'Space Mono', monospace;
}

/* Stats Summary */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 16px;
}
.stats-item {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 16px;
}
.stats-item-label {
  font-size: 11px;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.stats-item-value {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  font-weight: 700;
}
.stats-item-value.green { color: var(--accent-primary); }
.stats-item-value.purple { color: var(--accent-secondary); }
.stats-item-value.orange { color: var(--accent-warm); }
.stats-item-value.gold { color: var(--accent-gold); }
.stats-item-change {
  font-size: 11px;
  color: var(--accent-primary);
  margin-top: 4px;
}

/* ===== Achievements Page ===== */
.achievements-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.achievement-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 16px;
  text-align: center;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}
.achievement-card.unlocked {
  border-color: rgba(255, 209, 102, 0.3);
}
.achievement-card.unlocked::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 50% 30%, rgba(255, 209, 102, 0.08), transparent 70%);
}
.achievement-card.locked { opacity: 0.5; }
.achievement-icon {
  font-size: 36px;
  margin-bottom: 10px;
  position: relative;
  z-index: 1;
}
.achievement-name {
  font-size: 13px;
  font-weight: 700;
  margin-bottom: 4px;
  position: relative;
  z-index: 1;
}
.achievement-desc {
  font-size: 11px;
  color: var(--text-secondary);
  position: relative;
  z-index: 1;
}
.achievement-reward {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  margin-top: 8px;
  font-size: 11px;
  color: var(--accent-gold);
  background: rgba(255, 209, 102, 0.1);
  padding: 3px 10px;
  border-radius: 12px;
  position: relative;
  z-index: 1;
}
.achievement-progress {
  width: 100%;
  height: 3px;
  background: var(--bg-secondary);
  border-radius: 2px;
  margin-top: 10px;
  overflow: hidden;
  position: relative;
  z-index: 1;
}
.achievement-progress-fill {
  height: 100%;
  border-radius: 2px;
  background: linear-gradient(90deg, var(--accent-gold), var(--accent-warm));
  transition: width 0.5s;
}

/* ===== Wallet Page ===== */
.wallet-balance-card {
  background: linear-gradient(135deg, #1a1040 0%, #0d1f3c 50%, #1a1a40 100%);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 28px 24px;
  text-align: center;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}
.wallet-balance-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 50% 0%, rgba(255, 209, 102, 0.08), transparent 60%);
}
.wallet-balance-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 2px;
  font-family: 'Space Mono', monospace;
  position: relative;
  z-index: 1;
}
.wallet-balance-amount {
  font-family: 'Orbitron', sans-serif;
  font-size: 42px;
  font-weight: 900;
  color: var(--accent-gold);
  margin: 8px 0;
  position: relative;
  z-index: 1;
}
.wallet-balance-usd {
  font-size: 14px;
  color: var(--text-secondary);
  position: relative;
  z-index: 1;
}
.wallet-address {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 16px;
  font-size: 12px;
  color: var(--text-muted);
  font-family: 'Space Mono', monospace;
  position: relative;
  z-index: 1;
}
.wallet-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 20px;
}
.wallet-action-btn {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  font-family: 'Noto Sans SC', sans-serif;
  color: var(--text-primary);
  font-size: 14px;
  font-weight: 500;
}
.wallet-action-btn:hover { border-color: var(--accent-primary); }
.wallet-action-icon { font-size: 24px; margin-bottom: 8px; }

.tx-list { margin-bottom: 20px; }
.tx-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}
.tx-icon-wrap {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}
.tx-icon-wrap.earn {
  background: rgba(0, 245, 212, 0.1);
}
.tx-icon-wrap.nft {
  background: rgba(123, 97, 255, 0.1);
}
.tx-info { flex: 1; }
.tx-title { font-size: 13px; font-weight: 500; }
.tx-date { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.tx-amount { font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; }
.tx-amount.positive { color: var(--accent-primary); }
.tx-amount.nft-reward { color: var(--accent-secondary); }

/* ===== Bottom Navigation ===== */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 480px;
  background: rgba(10, 10, 26, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  display: flex;
  padding: 8px 0;
  padding-bottom: max(8px, env(safe-area-inset-bottom));
  z-index: 100;
}
.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 8px 4px;
  cursor: pointer;
  transition: all 0.3s;
  border: none;
  background: none;
  font-family: 'Noto Sans SC', sans-serif;
}
.nav-icon {
  font-size: 22px;
  transition: all 0.3s;
}
.nav-label {
  font-size: 10px;
  color: var(--text-muted);
  transition: all 0.3s;
}
.nav-item.active .nav-icon { transform: scale(1.1); }
.nav-item.active .nav-label { color: var(--accent-primary); font-weight: 700; }

/* ===== Connect Wallet Modal ===== */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index: 200;
  align-items: flex-end;
  justify-content: center;
}
.modal-overlay.show {
  display: flex;
  animation: fadeIn 0.3s;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.modal-sheet {
  background: var(--bg-secondary);
  border-radius: var(--radius) var(--radius) 0 0;
  padding: 24px 20px;
  padding-bottom: max(24px, env(safe-area-inset-bottom));
  width: 100%;
  max-width: 480px;
  animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}
@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}
.modal-handle {
  width: 36px;
  height: 4px;
  border-radius: 2px;
  background: var(--text-muted);
  margin: 0 auto 20px;
}
.modal-title {
  font-size: 18px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 20px;
}
.wallet-option {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  margin-bottom: 10px;
  cursor: pointer;
  transition: all 0.3s;
}
.wallet-option:hover { border-color: var(--accent-primary); }
.wallet-option-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
}
.wallet-option-name { font-size: 15px; font-weight: 500; }

/* Training Complete Modal */
.complete-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  z-index: 200;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.complete-modal.show {
  display: flex;
  animation: fadeIn 0.3s;
}
.complete-content {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 40px 24px;
  text-align: center;
  width: 100%;
  max-width: 360px;
  animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
}
@keyframes scaleIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}
.complete-icon { font-size: 64px; margin-bottom: 16px; }
.complete-title {
  font-size: 24px;
  font-weight: 900;
  margin-bottom: 8px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.complete-subtitle {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}
.reward-display {
  background: rgba(255, 209, 102, 0.08);
  border: 1px solid rgba(255, 209, 102, 0.2);
  border-radius: var(--radius-sm);
  padding: 16px;
  margin-bottom: 24px;
}
.reward-label {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 4px;
}
.reward-amount {
  font-family: 'Orbitron', sans-serif;
  font-size: 28px;
  font-weight: 900;
  color: var(--accent-gold);
}
.reward-bonus {
  font-size: 12px;
  color: var(--accent-primary);
  margin-top: 4px;
}
.complete-btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: var(--radius-sm);
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  color: var(--bg-primary);
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  font-family: 'Noto Sans SC', sans-serif;
}

/* ===== Toast Notifications ===== */
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(-100px);
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 12px 20px;
  font-size: 14px;
  z-index: 300;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  box-shadow: var(--shadow);
  max-width: 90%;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* ===== Reminder Settings ===== */
.reminder-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
}
.reminder-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}
.reminder-row:last-child { border-bottom: none; }
.reminder-info { flex: 1; }
.reminder-title { font-size: 14px; font-weight: 500; }
.reminder-desc { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
.toggle {
  width: 48px;
  height: 28px;
  border-radius: 14px;
  background: var(--bg-secondary);
  border: 2px solid var(--text-muted);
  position: relative;
  cursor: pointer;
  transition: all 0.3s;
}
.toggle.on {
  background: rgba(0, 245, 212, 0.2);
  border-color: var(--accent-primary);
}
.toggle-knob {
  position: absolute;
  top: 2px;
  left: 2px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--text-muted);
  transition: all 0.3s;
}
.toggle.on .toggle-knob {
  left: 22px;
  background: var(--accent-primary);
  box-shadow: 0 0 8px var(--glow-primary);
}

/* ===== Utility ===== */
.hidden { display: none !important; }
.text-center { text-align: center; }

/* Scrollbar */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 2px; }

/* Sound toggle */
.sound-toggle {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--bg-card);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  z-index: 10;
  transition: all 0.3s;
}
</style>
</head>

<body>

<div class="app" id="app">

  <!-- Header -->
  <div class="header">
    <div class="logo">
      <div class="logo-icon">ğŸ«§</div>
      <span class="logo-text">TIGANG</span>
    </div>
    <div class="header-wallet" id="headerWallet" onclick="showWalletModal()">
      <span class="wallet-dot" id="walletDot"></span>
      <span id="walletStatusText">è¿æ¥é’±åŒ…</span>
    </div>
  </div>

  <!-- ===== Home Page ===== -->
  <div class="page active" id="page-home">
    <div class="greeting" id="greeting">æ—©ä¸Šå¥½ ğŸ‘‹</div>
    <div class="greeting-sub">ä»Šå¤©ä¹Ÿè¦åšæŒé”»ç‚¼å“¦</div>

    <div class="streak-card">
      <div class="streak-top">
        <div>
          <div class="streak-label">è¿ç»­æ‰“å¡</div>
          <div class="streak-number" id="streakNumber">0<span class="streak-unit">å¤©</span></div>
        </div>
        <div class="streak-badge" id="streakBadge">ğŸ”¥ æ–°æ‰‹ä¸Šè·¯</div>
      </div>
      <div class="week-dots" id="weekDots"></div>
    </div>

    <button class="start-btn" onclick="startTraining()">
      âš¡ å¼€å§‹ä»Šæ—¥è®­ç»ƒ
    </button>

    <div class="quick-stats">
      <div class="stat-card">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-value" id="totalSessions">0</div>
        <div class="stat-label">æ€»è®­ç»ƒæ¬¡æ•°</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">â±ï¸</div>
        <div class="stat-value" id="totalMinutes">0</div>
        <div class="stat-label">æ€»åˆ†é’Ÿæ•°</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’</div>
        <div class="stat-value" id="totalTokens">0</div>
        <div class="stat-label">$TIGAN</div>
      </div>
    </div>

    <div class="token-banner" onclick="navigateTo('wallet')">
      <div class="token-icon">ğŸ’°</div>
      <div class="token-info">
        <div class="token-title">$TIGAN ä»£å¸å¥–åŠ±</div>
        <div class="token-desc">æ¯æ¬¡è®­ç»ƒå¯è·å¾— 10-50 $TIGAN</div>
      </div>
      <div class="token-amount" id="bannerTokens">0</div>
    </div>

    <!-- Reminder Settings -->
    <div class="section-title">â° è®­ç»ƒæé†’</div>
    <div class="reminder-section">
      <div class="reminder-row">
        <div class="reminder-info">
          <div class="reminder-title">æ¯æ—¥æé†’</div>
          <div class="reminder-desc">æ¯å¤©æ—©ä¸Š 9:00 æé†’è®­ç»ƒ</div>
        </div>
        <div class="toggle on" onclick="toggleReminder(this)">
          <div class="toggle-knob"></div>
        </div>
      </div>
      <div class="reminder-row">
        <div class="reminder-info">
          <div class="reminder-title">ä¹…åæé†’</div>
          <div class="reminder-desc">æ¯ 2 å°æ—¶æé†’æ´»åŠ¨ä¸€ä¸‹</div>
        </div>
        <div class="toggle" onclick="toggleReminder(this)">
          <div class="toggle-knob"></div>
        </div>
      </div>
      <div class="reminder-row">
        <div class="reminder-info">
          <div class="reminder-title">è¿ç»­æ‰“å¡æé†’</div>
          <div class="reminder-desc">å³å°†æ–­ç­¾æ—¶ç´§æ€¥æé†’</div>
        </div>
        <div class="toggle on" onclick="toggleReminder(this)">
          <div class="toggle-knob"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Training Page ===== -->
  <div class="page" id="page-train">
    <div class="training-header">
      <div class="training-title" id="trainingModeName">åŸºç¡€è®­ç»ƒ</div>
      <div class="training-subtitle" id="trainingModeDesc">é€‚åˆåˆå­¦è€…çš„å…¥é—¨è¯¾ç¨‹</div>
    </div>

    <div class="mode-selector">
      <div class="mode-card active" data-mode="basic" onclick="selectMode(this)">
        <div class="mode-card-icon">ğŸŒ±</div>
        <div class="mode-card-name">åŸºç¡€è®­ç»ƒ</div>
        <div class="mode-card-desc">5ç§’æ”¶ç¼© + 5ç§’æ”¾æ¾</div>
      </div>
      <div class="mode-card" data-mode="intermediate" onclick="selectMode(this)">
        <div class="mode-card-icon">ğŸ’ª</div>
        <div class="mode-card-name">è¿›é˜¶è®­ç»ƒ</div>
        <div class="mode-card-desc">8ç§’æ”¶ç¼© + 4ç§’æ”¾æ¾</div>
      </div>
      <div class="mode-card" data-mode="advanced" onclick="selectMode(this)">
        <div class="mode-card-icon">ğŸ”¥</div>
        <div class="mode-card-name">é«˜çº§è®­ç»ƒ</div>
        <div class="mode-card-desc">10ç§’æ”¶ç¼© + 3ç§’æ”¾æ¾</div>
      </div>
      <div class="mode-card" data-mode="quick" onclick="selectMode(this)">
        <div class="mode-card-icon">âš¡</div>
        <div class="mode-card-name">å¿«é€Ÿè„‰å†²</div>
        <div class="mode-card-desc">2ç§’å¿«é€Ÿæ”¶æ”¾</div>
      </div>
    </div>

    <div class="training-circle-wrap">
      <div class="training-circle" id="trainingCircle">
        <svg viewBox="0 0 240 240">
          <defs>
            <linearGradient id="progressGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#00f5d4"/>
              <stop offset="100%" style="stop-color:#7b61ff"/>
            </linearGradient>
          </defs>
          <circle class="track" cx="120" cy="120" r="115"/>
          <circle class="progress-ring" id="progressRing" cx="120" cy="120" r="115"/>
        </svg>
        <div class="breath-ring" id="breathRing"></div>
        <div class="training-phase" id="trainingPhase">å‡†å¤‡å¼€å§‹</div>
        <div class="training-action" id="trainingAction">ğŸ«§</div>
        <div class="training-timer" id="trainingTimer">0</div>
        <div class="training-round" id="trainingRound">ç¬¬ 0/0 ç»„</div>
      </div>
    </div>

    <div class="training-controls">
      <button class="train-ctrl-btn" onclick="resetTraining()" title="é‡ç½®">â†º</button>
      <button class="train-ctrl-btn primary" id="playPauseBtn" onclick="toggleTraining()">â–¶</button>
      <button class="train-ctrl-btn sound-btn" onclick="toggleSound()" title="å£°éŸ³">ğŸ””</button>
    </div>
  </div>

  <!-- ===== Stats Page ===== -->
  <div class="page" id="page-stats">
    <div class="section-title">ğŸ“Š è®­ç»ƒç»Ÿè®¡</div>
    
    <div class="stats-grid">
      <div class="stats-item">
        <div class="stats-item-label">æœ¬å‘¨è®­ç»ƒ</div>
        <div class="stats-item-value green" id="weekSessions">0</div>
        <div class="stats-item-change" id="weekChange">+0 vs ä¸Šå‘¨</div>
      </div>
      <div class="stats-item">
        <div class="stats-item-label">æœ¬æœˆè®­ç»ƒ</div>
        <div class="stats-item-value purple" id="monthSessions">0</div>
        <div class="stats-item-change">ğŸ“ˆ æŒç»­è¿›æ­¥</div>
      </div>
      <div class="stats-item">
        <div class="stats-item-label">æœ€é•¿è¿ç»­</div>
        <div class="stats-item-value orange" id="longestStreak">0</div>
        <div class="stats-item-change">å¤©</div>
      </div>
      <div class="stats-item">
        <div class="stats-item-label">ç´¯è®¡å¥–åŠ±</div>
        <div class="stats-item-value gold" id="totalRewards">0</div>
        <div class="stats-item-change">$TIGAN</div>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-title">æ¯æ—¥è®­ç»ƒ</div>
        <div class="chart-period">è¿‘7å¤©</div>
      </div>
      <div class="bar-chart" id="barChart"></div>
    </div>

    <div class="chart-card">
      <div class="chart-header">
        <div class="chart-title">è®­ç»ƒçƒ­åŠ›å›¾</div>
        <div class="chart-period" id="heatmapMonth">æœ¬æœˆ</div>
      </div>
      <div id="heatmap" style="display:grid; grid-template-columns:repeat(7,1fr); gap:4px; padding:8px 0;"></div>
    </div>
  </div>

  <!-- ===== Achievements Page ===== -->
  <div class="page" id="page-achieve">
    <div class="section-title">ğŸ† æˆå°±ç³»ç»Ÿ</div>
    <div class="achievements-grid" id="achievementsGrid"></div>
  </div>

  <!-- ===== Wallet Page ===== -->
  <div class="page" id="page-wallet">
    <div class="section-title">ğŸ’ é’±åŒ… & å¥–åŠ±</div>
    
    <div class="wallet-balance-card">
      <div class="wallet-balance-label">$TIGAN ä½™é¢</div>
      <div class="wallet-balance-amount" id="walletBalance">0</div>
      <div class="wallet-balance-usd" id="walletUsd">â‰ˆ $0.00 USD</div>
      <div class="wallet-address" id="walletAddr">
        <span>æœªè¿æ¥é’±åŒ…</span>
      </div>
    </div>

    <div class="wallet-actions">
      <div class="wallet-action-btn" onclick="showWalletModal()">
        <div class="wallet-action-icon">ğŸ”—</div>
        è¿æ¥é’±åŒ…
      </div>
      <div class="wallet-action-btn" onclick="showToast('ğŸš§ åŠŸèƒ½å¼€å‘ä¸­')">
        <div class="wallet-action-icon">ğŸ“¤</div>
        æå–ä»£å¸
      </div>
    </div>

    <div class="section-title">ğŸ“œ å¥–åŠ±è®°å½•</div>
    <div class="tx-list" id="txList"></div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="navigateTo('home')">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-label">é¦–é¡µ</span>
    </button>
    <button class="nav-item" onclick="navigateTo('train')">
      <span class="nav-icon">ğŸ«§</span>
      <span class="nav-label">è®­ç»ƒ</span>
    </button>
    <button class="nav-item" onclick="navigateTo('stats')">
      <span class="nav-icon">ğŸ“Š</span>
      <span class="nav-label">ç»Ÿè®¡</span>
    </button>
    <button class="nav-item" onclick="navigateTo('achieve')">
      <span class="nav-icon">ğŸ†</span>
      <span class="nav-label">æˆå°±</span>
    </button>
    <button class="nav-item" onclick="navigateTo('wallet')">
      <span class="nav-icon">ğŸ’</span>
      <span class="nav-label">é’±åŒ…</span>
    </button>
  </nav>
</div>

<!-- Wallet Connection Modal -->
<div class="modal-overlay" id="walletModal">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">è¿æ¥ Solana é’±åŒ…</div>
    <div class="wallet-option" onclick="connectWallet('phantom')">
      <div class="wallet-option-icon" style="background:linear-gradient(135deg,#ab9ff2,#6e56cf);">ğŸ‘»</div>
      <div class="wallet-option-name">Phantom</div>
    </div>
    <div class="wallet-option" onclick="connectWallet('solflare')">
      <div class="wallet-option-icon" style="background:linear-gradient(135deg,#fc7b1e,#f5c842);">â˜€ï¸</div>
      <div class="wallet-option-name">Solflare</div>
    </div>
    <div class="wallet-option" onclick="connectWallet('backpack')">
      <div class="wallet-option-icon" style="background:linear-gradient(135deg,#e33e3f,#f06449);">ğŸ’</div>
      <div class="wallet-option-name">Backpack</div>
    </div>
    <div style="text-align:center; margin-top:16px;">
      <span style="font-size:12px; color:var(--text-muted); cursor:pointer;" onclick="closeWalletModal()">å–æ¶ˆ</span>
    </div>
  </div>
</div>

<!-- Training Complete Modal -->
<div class="complete-modal" id="completeModal">
  <div class="complete-content">
    <div class="complete-icon">ğŸ‰</div>
    <div class="complete-title">è®­ç»ƒå®Œæˆï¼</div>
    <div class="complete-subtitle" id="completeSubtitle">å¤ªæ£’äº†ï¼Œä½ å®Œæˆäº†ä»Šæ—¥è®­ç»ƒ</div>
    <div class="reward-display">
      <div class="reward-label">æœ¬æ¬¡è·å¾—å¥–åŠ±</div>
      <div class="reward-amount" id="rewardAmount">+20 $TIGAN</div>
      <div class="reward-bonus" id="rewardBonus"></div>
    </div>
    <button class="complete-btn" onclick="closeCompleteModal()">ç»§ç»­åŠ æ²¹ ğŸ’ª</button>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ===== DATA LAYER =====
const STORAGE_KEY = 'tigang_data';

const defaultData = () => ({
  streak: 0,
  longestStreak: 0,
  totalSessions: 0,
  totalMinutes: 0,
  totalTokens: 0,
  sessions: [], // { date, mode, duration, rounds, tokens }
  achievements: {},
  walletConnected: false,
  walletAddress: '',
  walletType: '',
  soundEnabled: true,
  lastTrainDate: null,
  weekCheckins: {}, // { 'YYYY-MM-DD': true }
});

function loadData() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) return { ...defaultData(), ...JSON.parse(raw) };
  } catch(e) {}
  return defaultData();
}

function saveData(data) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch(e) {}
}

let appData = loadData();

// ===== TRAINING ENGINE =====
const MODES = {
  basic: { name: 'åŸºç¡€è®­ç»ƒ', desc: 'é€‚åˆåˆå­¦è€…çš„å…¥é—¨è¯¾ç¨‹', contract: 5, relax: 5, rounds: 8, reward: 10 },
  intermediate: { name: 'è¿›é˜¶è®­ç»ƒ', desc: 'æå‡è®­ç»ƒå¼ºåº¦', contract: 8, relax: 4, rounds: 10, reward: 20 },
  advanced: { name: 'é«˜çº§è®­ç»ƒ', desc: 'æŒ‘æˆ˜æé™', contract: 10, relax: 3, rounds: 12, reward: 35 },
  quick: { name: 'å¿«é€Ÿè„‰å†²', desc: 'å¿«èŠ‚å¥è®­ç»ƒ', contract: 2, relax: 2, rounds: 20, reward: 25 },
};

let currentMode = 'basic';
let training = {
  active: false,
  paused: false,
  phase: 'idle', // idle, countdown, contract, relax, rest, done
  currentRound: 0,
  timer: 0,
  intervalId: null,
  totalElapsed: 0,
};

// Audio context for sound feedback
let audioCtx = null;
function initAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}
function playTone(freq, duration, type='sine') {
  if (!appData.soundEnabled) return;
  try {
    initAudio();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
  } catch(e) {}
}
function playContractSound() { playTone(523, 0.2); }
function playRelaxSound() { playTone(392, 0.3); }
function playCompleteSound() {
  playTone(523, 0.15);
  setTimeout(() => playTone(659, 0.15), 150);
  setTimeout(() => playTone(784, 0.3), 300);
}
function playTickSound() { playTone(880, 0.05, 'square'); }

function selectMode(el) {
  document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  currentMode = el.dataset.mode;
  const mode = MODES[currentMode];
  document.getElementById('trainingModeName').textContent = mode.name;
  document.getElementById('trainingModeDesc').textContent = mode.desc;
  resetTraining();
}

function startTraining() {
  navigateTo('train');
  setTimeout(() => {
    if (!training.active) toggleTraining();
  }, 300);
}

function toggleTraining() {
  if (training.phase === 'done') {
    resetTraining();
    return;
  }
  if (!training.active) {
    training.active = true;
    training.paused = false;
    training.currentRound = 0;
    training.totalElapsed = 0;
    document.getElementById('playPauseBtn').textContent = 'â¸';
    startCountdown();
  } else if (training.paused) {
    training.paused = false;
    document.getElementById('playPauseBtn').textContent = 'â¸';
    runPhase();
  } else {
    training.paused = true;
    document.getElementById('playPauseBtn').textContent = 'â–¶';
    clearInterval(training.intervalId);
  }
}

function resetTraining() {
  clearInterval(training.intervalId);
  training = { active: false, paused: false, phase: 'idle', currentRound: 0, timer: 0, intervalId: null, totalElapsed: 0 };
  document.getElementById('playPauseBtn').textContent = 'â–¶';
  updateTrainingUI('å‡†å¤‡å¼€å§‹', 'ğŸ«§', 0, `ç¬¬ 0/${MODES[currentMode].rounds} ç»„`);
  updateProgressRing(0);
  document.getElementById('breathRing').className = 'breath-ring';
}

function startCountdown() {
  training.phase = 'countdown';
  training.timer = 3;
  updateTrainingUI('å‡†å¤‡', 'ğŸ', 3, 'å³å°†å¼€å§‹...');
  playTickSound();
  training.intervalId = setInterval(() => {
    training.timer--;
    if (training.timer <= 0) {
      clearInterval(training.intervalId);
      nextRound();
    } else {
      playTickSound();
      updateTrainingUI('å‡†å¤‡', 'ğŸ', training.timer, 'å³å°†å¼€å§‹...');
    }
  }, 1000);
}

function nextRound() {
  const mode = MODES[currentMode];
  training.currentRound++;
  if (training.currentRound > mode.rounds) {
    completeTraining();
    return;
  }
  // Contract phase
  training.phase = 'contract';
  training.timer = mode.contract;
  playContractSound();
  runPhase();
}

function runPhase() {
  const mode = MODES[currentMode];
  updatePhaseUI();
  
  training.intervalId = setInterval(() => {
    training.timer--;
    training.totalElapsed++;
    updatePhaseUI();
    
    if (training.timer <= 3 && training.timer > 0) playTickSound();
    
    if (training.timer <= 0) {
      clearInterval(training.intervalId);
      
      if (training.phase === 'contract') {
        training.phase = 'relax';
        training.timer = mode.relax;
        playRelaxSound();
        if (!training.paused) runPhase();
      } else if (training.phase === 'relax') {
        nextRound();
      }
    }
  }, 1000);
}

function updatePhaseUI() {
  const mode = MODES[currentMode];
  const round = `ç¬¬ ${training.currentRound}/${mode.rounds} ç»„`;
  const totalPhaseTime = training.phase === 'contract' ? mode.contract : mode.relax;
  const progress = ((training.currentRound - 1) + (1 - training.timer / totalPhaseTime) * (training.phase === 'contract' ? 0.5 : 0.5) + (training.phase === 'relax' ? 0.5 : 0)) / mode.rounds;
  
  if (training.phase === 'contract') {
    updateTrainingUI('æ”¶ç¼©', 'æ”¶ç´§ ğŸ’ª', training.timer, round);
    document.getElementById('trainingAction').className = 'training-action contract';
    document.getElementById('breathRing').className = 'breath-ring contract';
  } else if (training.phase === 'relax') {
    updateTrainingUI('æ”¾æ¾', 'æ”¾æ¾ ğŸŒŠ', training.timer, round);
    document.getElementById('trainingAction').className = 'training-action relax';
    document.getElementById('breathRing').className = 'breath-ring relax';
  }
  
  updateProgressRing(progress);
}

function updateTrainingUI(phase, action, timer, round) {
  document.getElementById('trainingPhase').textContent = phase;
  document.getElementById('trainingAction').textContent = action;
  document.getElementById('trainingTimer').textContent = timer;
  document.getElementById('trainingRound').textContent = round;
}

function updateProgressRing(progress) {
  const circumference = 2 * Math.PI * 115;
  const offset = circumference * (1 - Math.min(1, progress));
  document.getElementById('progressRing').style.strokeDashoffset = offset;
}

function completeTraining() {
  training.phase = 'done';
  training.active = false;
  playCompleteSound();
  
  const mode = MODES[currentMode];
  const duration = Math.ceil(training.totalElapsed / 60);
  
  // Calculate rewards
  let reward = mode.reward;
  let bonusText = '';
  
  // Streak bonus
  const today = getTodayStr();
  const wasChecked = appData.weekCheckins[today];
  
  if (!wasChecked) {
    appData.weekCheckins[today] = true;
    
    // Update streak
    const yesterday = getDateStr(new Date(Date.now() - 86400000));
    if (appData.lastTrainDate === yesterday || appData.lastTrainDate === today) {
      appData.streak++;
    } else if (appData.lastTrainDate !== today) {
      appData.streak = 1;
    }
    appData.lastTrainDate = today;
    
    if (appData.streak > appData.longestStreak) {
      appData.longestStreak = appData.streak;
    }
    
    // Streak bonus
    if (appData.streak >= 7) {
      reward = Math.floor(reward * 1.5);
      bonusText = `ğŸ”¥ è¿ç»­${appData.streak}å¤©åŠ æˆ x1.5`;
    } else if (appData.streak >= 3) {
      reward = Math.floor(reward * 1.2);
      bonusText = `ğŸ”¥ è¿ç»­${appData.streak}å¤©åŠ æˆ x1.2`;
    }
  } else {
    bonusText = 'ä»Šæ—¥å·²æ‰“å¡ï¼Œé¢å¤–è®­ç»ƒå¥–åŠ±å‡åŠ';
    reward = Math.floor(reward * 0.5);
  }
  
  appData.totalSessions++;
  appData.totalMinutes += duration;
  appData.totalTokens += reward;
  appData.sessions.push({
    date: today,
    mode: currentMode,
    duration,
    rounds: mode.rounds,
    tokens: reward,
    timestamp: Date.now(),
  });
  
  // Check achievements
  checkAchievements();
  
  saveData(appData);
  
  // Show complete modal
  document.getElementById('rewardAmount').textContent = `+${reward} $TIGAN`;
  document.getElementById('rewardBonus').textContent = bonusText;
  document.getElementById('completeSubtitle').textContent = 
    `å®Œæˆ ${mode.name} Â· ${mode.rounds}ç»„ Â· ${duration}åˆ†é’Ÿ`;
  document.getElementById('completeModal').classList.add('show');
  
  updateAllUI();
  document.getElementById('playPauseBtn').textContent = 'â†º';
}

function closeCompleteModal() {
  document.getElementById('completeModal').classList.remove('show');
}

// ===== ACHIEVEMENTS =====
const ACHIEVEMENTS = [
  { id: 'first', icon: 'ğŸŒŸ', name: 'åˆæ¬¡ä½“éªŒ', desc: 'å®Œæˆç¬¬ä¸€æ¬¡è®­ç»ƒ', condition: d => d.totalSessions >= 1, reward: 5 },
  { id: 'streak3', icon: 'ğŸ”¥', name: 'ä¸‰æ—¥è¿ç»­', desc: 'è¿ç»­æ‰“å¡3å¤©', condition: d => d.streak >= 3, reward: 15 },
  { id: 'streak7', icon: 'âš¡', name: 'ä¸€å‘¨è¾¾äºº', desc: 'è¿ç»­æ‰“å¡7å¤©', condition: d => d.streak >= 7, reward: 50 },
  { id: 'streak30', icon: 'ğŸ†', name: 'æœˆåº¦å† å†›', desc: 'è¿ç»­æ‰“å¡30å¤©', condition: d => d.streak >= 30, reward: 200 },
  { id: 'sessions10', icon: 'ğŸ’', name: 'åˆéœ²é”‹èŠ’', desc: 'ç´¯è®¡è®­ç»ƒ10æ¬¡', condition: d => d.totalSessions >= 10, reward: 30 },
  { id: 'sessions50', icon: 'ğŸ‘‘', name: 'è®­ç»ƒè¾¾äºº', desc: 'ç´¯è®¡è®­ç»ƒ50æ¬¡', condition: d => d.totalSessions >= 50, reward: 100 },
  { id: 'sessions100', icon: 'ğŸ¦¾', name: 'è¶…çº§æˆ˜å£«', desc: 'ç´¯è®¡è®­ç»ƒ100æ¬¡', condition: d => d.totalSessions >= 100, reward: 300 },
  { id: 'tokens100', icon: 'ğŸ’°', name: 'å°æœ‰ç§¯è“„', desc: 'ç´¯è®¡è·å¾—100 $TIGAN', condition: d => d.totalTokens >= 100, reward: 20 },
  { id: 'tokens1000', icon: 'ğŸ¦', name: 'ä»£å¸å¯Œç¿', desc: 'ç´¯è®¡è·å¾—1000 $TIGAN', condition: d => d.totalTokens >= 1000, reward: 100 },
  { id: 'advanced', icon: 'ğŸ”¥', name: 'æŒ‘æˆ˜æé™', desc: 'å®Œæˆä¸€æ¬¡é«˜çº§è®­ç»ƒ', condition: d => d.sessions.some(s => s.mode === 'advanced'), reward: 25 },
  { id: 'allmode', icon: 'ğŸ“', name: 'å…¨èƒ½é€‰æ‰‹', desc: 'ä½“éªŒæ‰€æœ‰è®­ç»ƒæ¨¡å¼', condition: d => {
    const modes = new Set(d.sessions.map(s => s.mode));
    return modes.size >= 4;
  }, reward: 50 },
  { id: 'hour', icon: 'â³', name: 'æ—¶é—´æŠ•èµ„è€…', desc: 'ç´¯è®¡è®­ç»ƒ60åˆ†é’Ÿ', condition: d => d.totalMinutes >= 60, reward: 40 },
];

function checkAchievements() {
  let newAchievement = false;
  ACHIEVEMENTS.forEach(a => {
    if (!appData.achievements[a.id] && a.condition(appData)) {
      appData.achievements[a.id] = { unlocked: true, date: getTodayStr() };
      appData.totalTokens += a.reward;
      newAchievement = a;
    }
  });
  if (newAchievement) {
    setTimeout(() => {
      showToast(`ğŸ† è§£é”æˆå°±: ${newAchievement.name} (+${newAchievement.reward} $TIGAN)`);
    }, 1500);
  }
}

function renderAchievements() {
  const grid = document.getElementById('achievementsGrid');
  grid.innerHTML = ACHIEVEMENTS.map(a => {
    const unlocked = appData.achievements[a.id];
    let progressPct = 0;
    
    // Calculate progress for some achievements
    if (a.id.startsWith('streak')) {
      const target = parseInt(a.desc.match(/\d+/)?.[0] || 0);
      progressPct = Math.min(100, (appData.streak / target) * 100);
    } else if (a.id.startsWith('sessions')) {
      const target = parseInt(a.desc.match(/\d+/)?.[0] || 0);
      progressPct = Math.min(100, (appData.totalSessions / target) * 100);
    } else if (a.id.startsWith('tokens')) {
      const target = parseInt(a.desc.match(/\d+/)?.[0] || 0);
      progressPct = Math.min(100, (appData.totalTokens / target) * 100);
    } else if (a.id === 'hour') {
      progressPct = Math.min(100, (appData.totalMinutes / 60) * 100);
    } else if (unlocked) {
      progressPct = 100;
    }
    
    return `
      <div class="achievement-card ${unlocked ? 'unlocked' : progressPct > 0 ? '' : 'locked'}">
        <div class="achievement-icon">${a.icon}</div>
        <div class="achievement-name">${a.name}</div>
        <div class="achievement-desc">${a.desc}</div>
        <div class="achievement-reward">ğŸ’° +${a.reward} $TIGAN</div>
        <div class="achievement-progress">
          <div class="achievement-progress-fill" style="width:${progressPct}%"></div>
        </div>
      </div>
    `;
  }).join('');
}

// ===== WALLET =====
function showWalletModal() {
  document.getElementById('walletModal').classList.add('show');
}
function closeWalletModal() {
  document.getElementById('walletModal').classList.remove('show');
}

function connectWallet(type) {
  closeWalletModal();
  
  // Simulate wallet connection
  const addr = 'Ti' + Array.from({length: 6}, () => 
    '0123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz'[Math.floor(Math.random()*58)]
  ).join('') + '...';
  
  appData.walletConnected = true;
  appData.walletAddress = addr;
  appData.walletType = type;
  saveData(appData);
  
  updateWalletUI();
  showToast(`âœ… å·²è¿æ¥ ${type.charAt(0).toUpperCase() + type.slice(1)} é’±åŒ…`);
}

function updateWalletUI() {
  const dot = document.getElementById('walletDot');
  const statusText = document.getElementById('walletStatusText');
  
  if (appData.walletConnected) {
    dot.classList.add('connected');
    statusText.textContent = appData.walletAddress;
    document.getElementById('walletAddr').innerHTML = `<span>ğŸŸ¢ ${appData.walletAddress}</span>`;
  } else {
    dot.classList.remove('connected');
    statusText.textContent = 'è¿æ¥é’±åŒ…';
    document.getElementById('walletAddr').innerHTML = '<span>æœªè¿æ¥é’±åŒ…</span>';
  }
  
  document.getElementById('walletBalance').textContent = appData.totalTokens.toLocaleString();
  document.getElementById('walletUsd').textContent = `â‰ˆ $${(appData.totalTokens * 0.001).toFixed(2)} USD`;
}

function renderTransactions() {
  const list = document.getElementById('txList');
  const recent = [...appData.sessions].reverse().slice(0, 10);
  
  if (recent.length === 0) {
    list.innerHTML = '<div style="text-align:center;color:var(--text-muted);padding:40px 0;">æš‚æ— å¥–åŠ±è®°å½•<br>å®Œæˆè®­ç»ƒå³å¯è·å¾—ä»£å¸</div>';
    return;
  }
  
  list.innerHTML = recent.map(s => `
    <div class="tx-item">
      <div class="tx-icon-wrap earn">ğŸ’°</div>
      <div class="tx-info">
        <div class="tx-title">${MODES[s.mode]?.name || 'è®­ç»ƒ'} å¥–åŠ±</div>
        <div class="tx-date">${s.date} Â· ${s.rounds}ç»„ Â· ${s.duration}åˆ†é’Ÿ</div>
      </div>
      <div class="tx-amount positive">+${s.tokens}</div>
    </div>
  `).join('');
}

// ===== NAVIGATION =====
function navigateTo(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(`page-${page}`).classList.add('active');
  
  document.querySelectorAll('.nav-item').forEach((n, i) => {
    n.classList.toggle('active', ['home','train','stats','achieve','wallet'][i] === page);
  });
  
  // Refresh page data
  if (page === 'stats') renderStats();
  if (page === 'achieve') renderAchievements();
  if (page === 'wallet') { updateWalletUI(); renderTransactions(); }
  if (page === 'home') updateHomeUI();
  
  window.scrollTo(0, 0);
}

// ===== UI UPDATES =====
function getTodayStr() {
  return new Date().toISOString().split('T')[0];
}
function getDateStr(d) {
  return d.toISOString().split('T')[0];
}

function updateGreeting() {
  const h = new Date().getHours();
  let g = 'æ™šä¸Šå¥½ ğŸŒ™';
  if (h < 6) g = 'å¤œæ·±äº† ğŸŒƒ';
  else if (h < 12) g = 'æ—©ä¸Šå¥½ â˜€ï¸';
  else if (h < 14) g = 'ä¸­åˆå¥½ ğŸŒ¤ï¸';
  else if (h < 18) g = 'ä¸‹åˆå¥½ ğŸŒ…';
  document.getElementById('greeting').textContent = g;
}

function updateHomeUI() {
  updateGreeting();
  
  document.getElementById('streakNumber').innerHTML = `${appData.streak}<span class="streak-unit">å¤©</span>`;
  document.getElementById('totalSessions').textContent = appData.totalSessions;
  document.getElementById('totalMinutes').textContent = appData.totalMinutes;
  document.getElementById('totalTokens').textContent = appData.totalTokens;
  document.getElementById('bannerTokens').textContent = appData.totalTokens;
  
  // Streak badge
  let badge = 'ğŸŒ± æ–°æ‰‹ä¸Šè·¯';
  if (appData.streak >= 30) badge = 'ğŸ‘‘ æè‚›å¤§å¸ˆ';
  else if (appData.streak >= 14) badge = 'ğŸ’ é’»çŸ³ä¼šå‘˜';
  else if (appData.streak >= 7) badge = 'âš¡ å‘¨å† è¾¾äºº';
  else if (appData.streak >= 3) badge = 'ğŸ”¥ åˆè§æˆæ•ˆ';
  document.getElementById('streakBadge').textContent = badge;
  
  // Week dots
  renderWeekDots();
}

function renderWeekDots() {
  const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
  const today = new Date();
  const dayOfWeek = (today.getDay() + 6) % 7; // Mon=0
  
  const dots = document.getElementById('weekDots');
  dots.innerHTML = '';
  
  for (let i = 0; i < 7; i++) {
    const d = new Date(today);
    d.setDate(d.getDate() - dayOfWeek + i);
    const dateStr = getDateStr(d);
    const isToday = i === dayOfWeek;
    const isDone = appData.weekCheckins[dateStr];
    
    dots.innerHTML += `
      <div class="week-dot">
        <span class="week-dot-label">${days[i]}</span>
        <div class="week-dot-circle ${isDone ? 'done' : ''} ${isToday && !isDone ? 'today' : ''}">
          ${isDone ? 'âœ“' : isToday ? 'Â·' : ''}
        </div>
      </div>
    `;
  }
}

function renderStats() {
  // Week sessions
  const today = new Date();
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - (today.getDay() + 6) % 7);
  const weekSessions = appData.sessions.filter(s => new Date(s.date) >= weekStart).length;
  document.getElementById('weekSessions').textContent = weekSessions;
  document.getElementById('monthSessions').textContent = appData.sessions.filter(s => {
    const d = new Date(s.date);
    return d.getMonth() === today.getMonth() && d.getFullYear() === today.getFullYear();
  }).length;
  document.getElementById('longestStreak').textContent = appData.longestStreak;
  document.getElementById('totalRewards').textContent = appData.totalTokens;
  
  // Bar chart - last 7 days
  const barChart = document.getElementById('barChart');
  barChart.innerHTML = '';
  const dayLabels = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
  
  for (let i = 6; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const dateStr = getDateStr(d);
    const count = appData.sessions.filter(s => s.date === dateStr).length;
    const height = count > 0 ? Math.max(15, Math.min(100, count * 30)) : 4;
    const isToday = i === 0;
    
    barChart.innerHTML += `
      <div class="bar-col">
        <div class="bar ${isToday ? 'today-bar' : ''}" style="height:${height}%"></div>
        <span class="bar-label">${dayLabels[d.getDay()]}</span>
      </div>
    `;
  }
  
  // Heatmap
  renderHeatmap();
}

function renderHeatmap() {
  const heatmap = document.getElementById('heatmap');
  heatmap.innerHTML = '';
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  
  document.getElementById('heatmapMonth').textContent = `${year}å¹´${month + 1}æœˆ`;
  
  // Fill empty cells for first day offset
  const firstDay = (new Date(year, month, 1).getDay() + 6) % 7;
  for (let i = 0; i < firstDay; i++) {
    heatmap.innerHTML += '<div style="width:100%;aspect-ratio:1;"></div>';
  }
  
  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const count = appData.sessions.filter(s => s.date === dateStr).length;
    const isToday = d === today.getDate();
    
    let bg = 'var(--bg-card)';
    if (count >= 3) bg = 'var(--accent-primary)';
    else if (count === 2) bg = 'rgba(0,245,212,0.5)';
    else if (count === 1) bg = 'rgba(0,245,212,0.25)';
    
    const border = isToday ? 'border:2px solid var(--accent-secondary);' : 'border:1px solid var(--border);';
    
    heatmap.innerHTML += `
      <div style="width:100%;aspect-ratio:1;background:${bg};border-radius:4px;${border}display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--text-muted);">
        ${d}
      </div>
    `;
  }
}

// ===== UTILITIES =====
function toggleReminder(el) {
  el.classList.toggle('on');
  if (el.classList.contains('on')) {
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }
  }
}

function toggleSound() {
  appData.soundEnabled = !appData.soundEnabled;
  saveData(appData);
  showToast(appData.soundEnabled ? 'ğŸ”” å£°éŸ³å·²å¼€å¯' : 'ğŸ”• å£°éŸ³å·²å…³é—­');
}

function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

function updateAllUI() {
  updateHomeUI();
  updateWalletUI();
}

// ===== INIT =====
function init() {
  // Check and fix streak
  const today = getTodayStr();
  const yesterday = getDateStr(new Date(Date.now() - 86400000));
  if (appData.lastTrainDate && appData.lastTrainDate !== today && appData.lastTrainDate !== yesterday) {
    appData.streak = 0; // streak broken
    saveData(appData);
  }
  
  updateAllUI();
  renderAchievements();
  
  // Close modals on overlay click
  document.getElementById('walletModal').addEventListener('click', function(e) {
    if (e.target === this) closeWalletModal();
  });
  document.getElementById('completeModal').addEventListener('click', function(e) {
    if (e.target === this) closeCompleteModal();
  });
}

// Check streak daily
function checkDailyStreak() {
  const today = getTodayStr();
  const yesterday = getDateStr(new Date(Date.now() - 86400000));
  if (appData.lastTrainDate && appData.lastTrainDate !== today && appData.lastTrainDate !== yesterday) {
    if (appData.streak > 0) {
      appData.streak = 0;
      saveData(appData);
      updateAllUI();
    }
  }
}

init();
setInterval(checkDailyStreak, 60000);
</script>
</body>
</html>
